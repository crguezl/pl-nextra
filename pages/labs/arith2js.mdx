---
title: Translating Arithmetic Expressions to JavaScript
layout: Practica
published: true
display: normal
date:
delivery:
campus: "https://campusingenieriaytecnologia2324.ull.es/mod/assign/view.php?id=20502"
key: arith2js
prev: "iaas.md"
next: #hello-compiler.md
order: 6
rubrica:
  - "Opciones en l√≠nea de comandos (-o, -V, -h, etc.)"
  - "Tutorial README.md y paneles bien presentados"
  - Todos los operadores han sido implementados con las precedencias correctas
  - Se ha usado commander para procesar la l√≠nea de argumentos
  - Utiliza ambos CommonJS y ECMAScript 
  - Se aportan pruebas usando Mocha
  - Se hace un estudio de cubrimiento de las pruebas
  - El package.json tiene scripts para ejecutar el programa
  - Ha entregado el zip en el campus
repo:
  text: "Repo hello-jison"
  href: "https://github.com/ull-esit-pl/hello-jison"
---
## Objetivos

Usando Jison generalice el ejemplo en la carpeta `ast` del [Repo hello-jison](https://github.com/ull-esit-pl/hello-jison) constituido por los ficheros:

* [minus-ast.jison](https://github.com/ULL-ESIT-PL/hello-jison/blob/master/ast/minus-ast.jison) 
* [ast-build.js](https://github.com/ULL-ESIT-PL/hello-jison/blob/master/ast/ast-build.js)
* [minus-ast.l](https://github.com/ULL-ESIT-PL/hello-jison/blob/master/ast/minus-ast.l)
* [ast2js.js](https://github.com/ULL-ESIT-PL/hello-jison/blob/master/ast/ast2js.js)

para escribir un programa que, recibiendo como entrada una cadena que contiene una secuencia de expresiones aritm√©ticas de enteros separados por comas, produzca un AST compatible con el del [parser espree](https://github.com/eslint/espree). 
Use [escodegen](https://github.com/estools/escodegen) para generar el c√≥digo JavaScript correspondiente (vea [ast2js.js](https://github.com/ULL-ESIT-PL/hello-jison/blob/master/ast/ast2js.js)). Sigue un ejemplo de una posible ejecuci√≥n:

```bash
‚úó cat test/data/test1.calc 
4 - 2 - 1                                                                                       
‚úó bin/calc2js.mjs test/data/test1.calc 
console.log(4 - 2 - 1);
‚úó bin/calc2js.js test/data/test1.calc | node -
1
```

Las expresiones aritm√©ticas deben soportar adem√°s de suma, resta, multiplicaci√≥n y divisi√≥n el menos unario `-(2+3)*2`   un operador de factorial `!`, un operador de potencia `**` y par√©ntesis. Ejemplo: `-(2 + 3) * 4! - 5 ** 6`.

## Opciones en l√≠nea de comandos

Use [commander](https://github.com/tj/commander.js#readme) para procesar la l√≠nea de argumentos:
  
```bash
$ bin/calc2js.mjs --help
Usage: calc2js [options] <filename>

Arguments:
  filename                 file with the original code

Options:
  -V, --version            output the version number
  -o, --output <filename>  file in which to write the output
  -h, --help               display help for command
```

## Dealing with Ambiguity

Para tratar con los temas de ambig√ºedad en la gram√°tica,
puede consultar 

* la secci√≥n [Precedencia y Asociatividad](https://crguezl.github.io/pl-html/node57.html) de los viejos apuntes de PL
* See the examples in the [Repo crguezl/jison-prec](https://github.com/crguezl/jison-prec).


## Unary minus and exponentiation in escodegen

import UnaryMinus from "../pl-includes/unaryminus-exponenciation-escodegen.mdx"


<UnaryMinus/>

## Pruebas

A√±ada pruebas a este proyecto usando [mocha](/topics/introduction-tojavascript/mocha.html)


import MockingStubbing from "../topics/introduction-to-javascript/mocking-stubbing.mdx"

<MockingStubbing/>


## Covering 

You can use  [nyc](https://www.npmjs.com/package/nyc) to do the covering of your mocha tests.
See the notes in [covering](/topics/introduction-to-javascript/covering). 

Activate the GitHub pages of your repo (use the default branch and the `docs` folder) and be sure to include your covering report in the `docs` folder.

```
‚úó npm run cov

> hello-jison@1.0.0 cov
> nyc npm test


> hello-jison@1.0.0 test
> npm run compile; mocha test/test.mjs


> hello-jison@1.0.0 compile
> jison src/grammar.jison src/lexer.l -o src/calc.js



  ‚úî transpile(test1.calc, out1.js)
  ‚úî transpile(test2.calc, out2.js)
  ‚úî transpile(test3.calc, out3.js)

  3 passing (20ms)

--------------|---------|----------|---------|---------|-----------------------------------------
File          | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                       
--------------|---------|----------|---------|---------|-----------------------------------------
All files     |   58.92 |    45.83 |   47.22 |   56.63 |                                         
 ast-build.js |     100 |      100 |     100 |     100 |                                         
 calc.js      |   57.44 |    45.78 |   40.62 |   54.92 | ...,530-539,548-569,578,580,602-607,610 
 transpile.js |   81.81 |       50 |     100 |   81.81 | 11-12                                   
--------------|---------|----------|---------|---------|-----------------------------------------
```

## Rubric

import { frontmatter} from '@/src/frontmatter'
import Rubric from '@/components/rubric'

<Rubric rubric={frontmatter().rubrica} />


## References

### Essentials for this lab

* See the examples in the repo [crguezl/hello-jison](https://github.com/crguezl/hello-jison)
* [https://astexplorer.net](https://astexplorer.net)
* [Tipos de Nodos del AST](/topics/introduction-to-pl/espree-visitorkeys) y nombres de las propiedades de los hijos
* [Escodegen repo en GitHub](https://github.com/estools/escodegen)
  - [Escodegen API Doc](https://github.com/estools/escodegen/wiki/API)
* [Jison Documentation](https://gerhobbelt.github.io/jison/docs//)

### Jison and Syntax Analysis

* [An√°lisis Sint√°ctico Ascendente en JavaScript](https://crguezl.github.io/pl-html/node43.html)
* [Jison](/topics/syntax-analysis/analysis-LR)
* [Mi primer proyecto utilizando Jison](https://ericknavarro.io/2019/07/21/17-Mi-primer-proyecto-utilizando-Jison-Linux/) por Erick Navarro
* [Folder jison/examples from the Jison distribution](https://github.com/zaach/jison/tree/master/examples)
* [Jison Debugger](https://nolanlawson.github.io/jison-debugger/)
* [Precedencia y Asociatividad](https://crguezl.github.io/pl-html/node57.html)
    - [Repo de ejemplo crguezl/jison-prec](https://github.com/crguezl/jison-prec)
* [Construcci√≥n de las Tablas para el An√°lisis SLR](https://crguezl.github.io/pl-html/node49.html)
* [Algoritmo de An√°lisis LR (yacc/bison/jison)](https://crguezl.github.io/pl-html/node55.html)
* [Repo ULL-ESIT-PL-1718/jison-aSb](https://github.com/ULL-ESIT-PL-1718/jison-aSb)
* [Repo ULL-ESIT-PL-1718/ull-etsii-grado-pl-jisoncalc](https://github.com/ULL-ESIT-PL-1718/ull-etsii-grado-pl-jisoncalc)
* <a href="https://medium.com/basecs/leveling-up-ones-parsing-game-with-asts-d7a6fc2400ff" rel="nofollow">Leveling Up One‚Äôs Parsing Game With ASTs</a> by <a href="https://twitter.com/vaidehijoshi" rel="nofollow">Vaidehi Joshi</a> <em> üëç</em>


### Have a look

* [JavaScript AST visualizer](https://resources.jointjs.com/demos/javascript-ast) jointjs demos
* [Espree](https://github.com/eslint/espree)
  * [Options for parse and tokenize methods](https://github.com/eslint/espree#options)